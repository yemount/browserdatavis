define("lib/xhr",["jquery","nbd/trait/promise"],function(t,i){"use strict";return function(){var e=new i,n=t.ajax.apply(t,arguments);return e.resolve(n),e.thenable()}}),define("be/Controller/Dialog",["nbd/Controller/Entity","nbd/util/media"],function(t,i){"use strict";var e=t.extend({init:function(){this._super.apply(this,arguments),this.mediaView=this.mediaView.bind(this),i.on("all",this.mediaView)},destroy:function(){i.off(null,this.mediaView),this._view&&this._view.destroy(),this._model.destroy()},_initView:function(t,e){var n,o=i.getState();n="function"==typeof t?t:o.map(function(i){return t[i]}).filter(function(t){return!!t})[0],"function"==typeof n&&(this._view=this._view=new n(e),this._view._controller=this._view._controller=this)},render:function(){return this._view&&this._view.render.apply(this._view,arguments)},mediaView:function(t,i){var e=this.constructor.VIEW_CLASS[t];e&&i&&this.requestView(e)},switchView:function(t){var i=this._view;return this._initView(t,this._model),i&&i.destroy()}});return e}),define("be/Controller/Dialog/Roulette",["jquery","be/Controller/Dialog","nbd/util/async"],function(t,i,e){"use strict";var n=i.extend({$context:null,setContext:function(t){this.$context&&this.$context.off("click"),this.$context=t.on("click",function(t){t.isDefaultPrevented()||t.originalEvent.data===this._view||this.toggle(t.delegateTarget)}.bind(this))},render:function(t){var i=this._view.render(document.body);return this._view.position(t),i},toggle:function(t){this._view.$view&&this._view.$view.length?(this._view.toggle(),this._view.position(t)):(this.render(t||this.$context),e(this._view.show.bind(this._view)))}});return n}),define("lib/picturefill",["jquery"],function(t){"use strict";var i=window.matchMedia||window.msMatchMedia,e=function(){var e=t(this),n=e.find("div[data-src]");return n.length?(i&&(n=n.first().add(n.filter(function(){var e=t(this).data("media");return e&&i(e).matches})).last()),e.attr("data-rendered","rendered"),void t("<img>",{alt:e.data("alt"),src:n.data("src"),"class":n.data("class"),title:n.data("title"),"data-pin-nopin":"pin"}).appendTo(e)):void e.find("img").remove()};return t.fn.picturefill=function(){return this.find("div[data-picture]:not([data-rendered])").each(e),this}}),define("lib/truncate",[],function(){"use strict";return function(t,i){if(t.length&&document.createRange){var e,n=document.createRange();if(n.getBoundingClientRect&&(e=/[^\s]/.exec(t.textContent))){n.setStartBefore(t),n.setEnd(t,e.index+1);var o=n.getBoundingClientRect().height,a=o*(i+.5),s=t.length,r=s,c=-1;if(n.setEndAfter(t),o=n.getBoundingClientRect().height,a>o)return void n.detach();for(;r;)r=~~(r/2),s+=c*r,n.setEnd(t,s),o=n.getBoundingClientRect().height,c*(o-a)>0&&(c=-c);var l=t.textContent.substr(0,s);l=l.replace(/\s+$/,"");do t.textContent=l+"â€¦",n.setEndAfter(t),o=n.getBoundingClientRect().height,l=l.substr(0,--s);while(o>a);n.detach()}}}}),define("require/hgn!templates/notifications/appreciation",["hogan"],function(t){function i(){return e.render.apply(e,arguments)}var e=new t.Template({code:function(t,i,e){var n=this;return n.b(e=e||""),n.b('<div class="msg extra-padding">'),n.b("\n"+e),n.b('  <a href="'),n.b(n.v(n.d("actor.url",t,i,0))),n.b('" class="js-mini-profile" data-id="'),n.b(n.v(n.d("actor.id",t,i,0))),n.b('">'),n.b(n.v(n.d("actor.display_name",t,i,0))),n.b("</a> appreciated your project"),n.b("\n"+e),n.b("</div>"),n.b("\n"+e),n.b('<a href="'),n.b(n.v(n.d("project.url",t,i,0))),n.b('" class="graphic">'),n.b("\n"+e),n.b('  <div class="activity-block project-appreciated">'),n.b("\n"+e),n.b('    <div data-picture="" data-alt="'),n.b(n.v(n.d("project.name",t,i,0))),n.b('">'),n.b("\n"+e),n.b('    <div alt="'),n.b(n.v(n.d("project.name",t,i,0))),n.b('" data-src="'),n.b(n.v(n.d("project.covers.115",t,i,0))),n.b('" data-class="project_image" data-title="'),n.b(n.v(n.d("project.name",t,i,0))),n.b('"></div>'),n.b("\n"+e),n.b('    <div alt="'),n.b(n.v(n.d("project.name",t,i,0))),n.b('" data-src="'),n.b(n.v(n.d("project.covers.202",t,i,0))),n.b('" data-class="project_image project_image-2x" data-title="'),n.b(n.v(n.d("project.name",t,i,0))),n.b('" data-media="(-webkit-min-device-pixel-ratio: 1.3),'),n.b("\n"+e),n.b("      (min--moz-device-pixel-ratio: 1.3),"),n.b("\n"+e),n.b("      (-o-min-device-pixel-ratio: 4/3),"),n.b("\n"+e),n.b("      (min-device-pixel-ratio: 1.3),"),n.b("\n"+e),n.b('      (min-resolution: 1.3dppx)"></div>'),n.b("\n"+e),n.b("    </div>"),n.b("\n"+e),n.b('    <noscript><img alt="'),n.b(n.v(n.d("project.name",t,i,0))),n.b('" title="'),n.b(n.v(n.d("project.name",t,i,0))),n.b('" src="'),n.b(n.v(n.d("project.covers.115",t,i,0))),n.b('" class="project_image" /></noscript>'),n.b("\n"+e),n.b("  </div>"),n.b("\n"+e),n.b("</a>"),n.b("\n"),n.fl()},partials:{},subs:{}},"",t);return i.template=e,i}),define("require/hgn!templates/notifications/collection",["hogan"],function(t){function i(){return e.render.apply(e,arguments)}var e=new t.Template({code:function(t,i,e){var n=this;return n.b(e=e||""),n.b('<div class="msg">'),n.b("\n"+e),n.b('  <span class="js-mini-profile" data-id="'),n.b(n.v(n.d("actor.id",t,i,0))),n.b('">'),n.b(n.v(n.d("actor.display_name",t,i,0))),n.b('</span> followed your collection "<a href="'),n.b(n.v(n.d("collection.url",t,i,0))),n.b('">'),n.b(n.v(n.d("collection.title",t,i,0))),n.b('</a>"'),n.b("\n"+e),n.b("</div>"),n.b("\n"),n.fl()},partials:{},subs:{}},"",t);return i.template=e,i}),define("require/hgn!templates/notifications/comment",["hogan"],function(t){function i(){return e.render.apply(e,arguments)}var e=new t.Template({code:function(t,i,e){var n=this;return n.b(e=e||""),n.b('<a href="'),n.b(n.v(n.f("url",t,i,0))),n.b('#comments" class="graphic">'),n.b("\n"+e),n.b('  <div data-picture="" data-alt="'),n.b(n.v(n.f("name",t,i,0))),n.b('">'),n.b("\n"+e),n.b('    <div alt="'),n.b(n.v(n.f("name",t,i,0))),n.b('" data-src="'),n.b(n.v(n.d("covers.115",t,i,0))),n.b('" data-class="comment-image" data-title="'),n.b(n.v(n.f("name",t,i,0))),n.b('"></div>'),n.b("\n"+e),n.b('    <div alt="'),n.b(n.v(n.f("name",t,i,0))),n.b('" data-src="'),n.b(n.v(n.d("covers.202",t,i,0))),n.b('" data-class="comment-image comment-image-2x" data-title="'),n.b(n.v(n.f("name",t,i,0))),n.b('" data-media="(-webkit-min-device-pixel-ratio: 1.3),'),n.b("\n"+e),n.b("        (min--moz-device-pixel-ratio: 1.3),"),n.b("\n"+e),n.b("        (-o-min-device-pixel-ratio: 4/3),"),n.b("\n"+e),n.b("        (min-device-pixel-ratio: 1.3),"),n.b("\n"+e),n.b('        (min-resolution: 1.3dppx)"></div>'),n.b("\n"+e),n.b("  </div>"),n.b("\n"+e),n.b('  <noscript><img alt="'),n.b(n.v(n.f("name",t,i,0))),n.b('" title="'),n.b(n.v(n.f("name",t,i,0))),n.b('" src="'),n.b(n.v(n.d("covers.115",t,i,0))),n.b('" class="comment-image" /></noscript>'),n.b("\n"),n.b("\n"+e),n.b('  <div class="comment">'),n.b("\n"+e),n.b('    <strong class="actor js-mini-profile" data-id="'),n.b(n.v(n.d("actor.id",t,i,0))),n.b('">'),n.b(n.v(n.d("actor.display_name",t,i,0))),n.b(':</strong> <span class="comment-text">'),n.b(n.v(n.d("comment.comment",t,i,0))),n.b("</span>"),n.b("\n"+e),n.b("  </div>"),n.b("\n"+e),n.b("</a>"),n.b("\n"),n.fl()},partials:{},subs:{}},"",t);return i.template=e,i}),define("require/hgn!templates/notifications/wip_comment",["hogan"],function(t){function i(){return e.render.apply(e,arguments)}var e=new t.Template({code:function(t,i,e){var n=this;return n.b(e=e||""),n.b('<a href="'),n.b(n.v(n.f("url",t,i,0))),n.b('" class="graphic">'),n.b("\n"+e),n.b('  <div data-picture="" data-alt="'),n.b(n.v(n.d("wip.title",t,i,0))),n.b('">'),n.b("\n"+e),n.b('    <div alt="'),n.b(n.v(n.d("wip.title",t,i,0))),n.b('" data-src="'),n.b(n.v(n.d("revision.images.thumbnail_sm.url",t,i,0))),n.b('" data-class="comment-image" data-title="'),n.b(n.v(n.d("wip.title",t,i,0))),n.b('"></div>'),n.b("\n"+e),n.b('    <div alt="'),n.b(n.v(n.d("wip.title",t,i,0))),n.b('" data-src="'),n.b(n.v(n.d("revision.images.thumbnail.url",t,i,0))),n.b('" data-class="comment-image comment-image-2x" data-title="'),n.b(n.v(n.d("wip.title",t,i,0))),n.b('" data-media="(-webkit-min-device-pixel-ratio: 1.3),'),n.b("\n"+e),n.b("        (min--moz-device-pixel-ratio: 1.3),"),n.b("\n"+e),n.b("        (-o-min-device-pixel-ratio: 4/3),"),n.b("\n"+e),n.b("        (min-device-pixel-ratio: 1.3),"),n.b("\n"+e),n.b('        (min-resolution: 1.3dppx)"></div>'),n.b("\n"+e),n.b("  </div>"),n.b("\n"+e),n.b('  <noscript><img alt="'),n.b(n.v(n.d("wip.title",t,i,0))),n.b('" title="'),n.b(n.v(n.d("wip.title",t,i,0))),n.b('" src="'),n.b(n.v(n.d("revision.images.thumbnail_sm.url",t,i,0))),n.b('" class="comment-image" /></noscript>'),n.b("\n"),n.b("\n"+e),n.b('  <div class="comment wip-notification-comment">'),n.b("\n"+e),n.b('    <strong class="actor js-mini-profile" data-id="'),n.b(n.v(n.d("actor.id",t,i,0))),n.b('">'),n.b(n.v(n.d("actor.display_name",t,i,0))),n.b(': </strong><span class="comment-text">'),n.b(n.v(n.d("comment.comment",t,i,0))),n.b("</span>"),n.b("\n"+e),n.b("  </div>"),n.b("\n"+e),n.b("</a>"),n.b("\n"),n.fl()},partials:{},subs:{}},"",t);return i.template=e,i}),define("require/hgn!templates/notifications/comment_stub",["hogan"],function(t){function i(){return e.render.apply(e,arguments)}var e=new t.Template({code:function(t,i,e){var n=this;return n.b(e=e||""),n.b('<div class="graphic">'),n.b("\n"+e),n.b('  <div class="project-comment-wrap">'),n.b("\n"+e),n.b('    <div class="activity-block project-comment">'),n.b("\n"+e),n.s(n.f("project",t,i,1),t,i,0,126,138,"{{ }}")&&(n.rs(t,i,function(t,i,e){e.b(e.rp("<comment0",t,i,""))}),t.pop()),n.s(n.f("revision",t,i,1),t,i,0,170,186,"{{ }}")&&(n.rs(t,i,function(t,i,e){e.b(e.rp("<wip_comment1",t,i,""))}),t.pop()),n.b("    </div>"),n.b("\n"+e),n.b("  </div>"),n.b("\n"+e),n.b("</div>"),n.fl()},partials:{"<comment0":{name:"comment",partials:{},subs:{}},"<wip_comment1":{name:"wip_comment",partials:{},subs:{}}},subs:{}},"",t);return i.template=e,i}),define("require/hgn!templates/notifications/followed",["hogan"],function(t){function i(){return e.render.apply(e,arguments)}var e=new t.Template({code:function(t,i,e){var n=this;return n.b(e=e||""),n.b('<div class="msg">'),n.b("\n"+e),n.b('  <a href="'),n.b(n.v(n.d("actor.url",t,i,0))),n.b('" class="js-mini-profile" data-id="'),n.b(n.v(n.d("actor.id",t,i,0))),n.b('">'),n.b(n.v(n.d("actor.display_name",t,i,0))),n.b("</a> followed your work"),n.b("\n"+e),n.b("</div>"),n.b("\n"),n.fl()},partials:{},subs:{}},"",t);return i.template=e,i}),define("require/hgn!templates/notifications/mention",["hogan"],function(t){function i(){return e.render.apply(e,arguments)}var e=new t.Template({code:function(t,i,e){var n=this;return n.b(e=e||""),n.b('<div class="msg extra-padding">'),n.b("\n"+e),n.b('  <a href="'),n.b(n.v(n.d("actor.url",t,i,0))),n.b('">'),n.b(n.v(n.d("actor.display_name",t,i,0))),n.b("</a> mentioned you in a comment"),n.b("\n"+e),n.b("</div>"),n.b("\n"+e),n.b('<div class="graphic">'),n.b("\n"+e),n.b('  <div class="mention-wrap">'),n.b("\n"+e),n.b('    <div class="activity-block mention">'),n.b("\n"+e),n.s(n.f("project",t,i,1),t,i,0,229,241,"{{ }}")&&(n.rs(t,i,function(t,i,e){e.b(e.rp("<comment0",t,i,""))}),t.pop()),n.s(n.f("revision",t,i,1),t,i,0,273,289,"{{ }}")&&(n.rs(t,i,function(t,i,e){e.b(e.rp("<wip_comment1",t,i,""))}),t.pop()),n.b("    </div>"),n.b("\n"+e),n.b("  </div>"),n.b("\n"+e),n.b("</div>"),n.fl()},partials:{"<comment0":{name:"comment",partials:{},subs:{}},"<wip_comment1":{name:"wip_comment",partials:{},subs:{}}},subs:{}},"",t);return i.template=e,i}),define("require/hgn!templates/notifications/saved",["hogan"],function(t){function i(){return e.render.apply(e,arguments)}var e=new t.Template({code:function(t,i,e){var n=this;return n.b(e=e||""),n.b('<div class="msg extra-padding">'),n.b("\n"+e),n.b('  <a href="'),n.b(n.v(n.d("actor.url",t,i,0))),n.b('" class="js-mini-profile" data-id="'),n.b(n.v(n.d("actor.id",t,i,0))),n.b('">'),n.b(n.v(n.d("actor.display_name",t,i,0))),n.b("</a> saved your project"),n.b("\n"+e),n.b("</div>"),n.b("\n"+e),n.b('<a href="'),n.b(n.v(n.d("collection.url",t,i,0))),n.b('" class="graphic">'),n.b("\n"+e),n.b('  <div class="activity-block project-collection">'),n.b("\n"),n.b("\n"+e),n.s(n.d("collection.latest_projects",t,i,1),t,i,0,290,986,"{{ }}")&&(n.rs(t,i,function(t,i,n){n.b('    <div class="collection-project-image-wrap" data-picture="" data-alt="'),n.b(n.v(n.d("collection.title",t,i,0))),n.b('">'),n.b("\n"+e),n.b('    <div alt="'),n.b(n.v(n.f("name",t,i,0))),n.b('" data-src="'),n.b(n.v(n.d("covers.115",t,i,0))),n.b('" data-class="collection-project-image" data-title="'),n.b(n.v(n.f("name",t,i,0))),n.b('"></div>'),n.b("\n"+e),n.b('    <div alt="'),n.b(n.v(n.f("name",t,i,0))),n.b('" data-src="'),n.b(n.v(n.d("covers.202",t,i,0))),n.b('" data-class="collection-project-image collection-project-image-2x" data-title="'),n.b(n.v(n.f("name",t,i,0))),n.b('" data-media="(-webkit-min-device-pixel-ratio: 1.3),'),n.b("\n"+e),n.b("      (min--moz-device-pixel-ratio: 1.3),"),n.b("\n"+e),n.b("      (-o-min-device-pixel-ratio: 4/3),"),n.b("\n"+e),n.b("      (min-device-pixel-ratio: 1.3),"),n.b("\n"+e),n.b('      (min-resolution: 1.3dppx)"></div>'),n.b("\n"+e),n.b("    </div>"),n.b("\n"+e),n.b('    <noscript><img alt="'),n.b(n.v(n.f("name",t,i,0))),n.b('" title="'),n.b(n.v(n.f("name",t,i,0))),n.b('" src="'),n.b(n.v(n.d("covers.115",t,i,0))),n.b('" class="collection-project-image" /></noscript>'),n.b("\n"+e)}),t.pop()),n.b('    <div class="collection-title">'),n.b("\n"+e),n.b('      <span class="collection-title-text"><div class="be-font-inline collection-icon">N</div>'),n.b(n.v(n.d("collection.title",t,i,0))),n.b("</span>"),n.b("\n"+e),n.b("    </div>"),n.b("\n"+e),n.b("  </div>"),n.b("\n"+e),n.b("</a>"),n.b("\n"),n.fl()},partials:{},subs:{}},"",t);return i.template=e,i}),define("require/hgn!templates/notifications/social",["hogan"],function(t){function i(){return e.render.apply(e,arguments)}var e=new t.Template({code:function(t,i,e){var n=this;return n.b(e=e||""),n.b('<div class="msg">Your '),n.b(n.v(n.f("app",t,i,0))),n.b(' friend <a class="js-mini-profile" data-id="'),n.b(n.v(n.d("actor.id",t,i,0))),n.b('" href="'),n.b(n.v(n.d("actor.url",t,i,0))),n.b('">'),n.b(n.v(n.d("actor.display_name",t,i,0))),n.b("</a> joined Behance</div>"),n.b("\n"),n.fl()},partials:{},subs:{}},"",t);return i.template=e,i}),define("be/trait/notificationPartial",["hgn!templates/notifications/appreciation","hgn!templates/notifications/collection","hgn!templates/notifications/comment","hgn!templates/notifications/wip_comment","hgn!templates/notifications/comment_stub","hgn!templates/notifications/followed","hgn!templates/notifications/mention","hgn!templates/notifications/saved","hgn!templates/notifications/social"],function(t,i,e,n,o,a,s,r,c){"use strict";var l={appreciate:t.template,followcollection:i.template,projectcomment:o.template,wipcomment:o.template,followuser:a.template,projectaddedtocollection:r.template,socialfriendjoined:c.template,usermentionprojectcomment:s.template,usermentionwiprevisioncomment:s.template};return{generatePartials:function(t){return{innard:l[t.action_key],comment:e.template,wip_comment:n.template}}}}),define("require/hgn!templates/notification",["hogan"],function(t){function i(){return e.render.apply(e,arguments)}var e=new t.Template({code:function(t,i,e){var n=this;return n.b(e=e||""),n.b('<div class="notification-group'),n.s(n.f("read_on",t,i,1),t,i,1,0,0,"")||n.b(" unread"),n.b('">'),n.b("\n"+e),n.b('  <div class="notification-container">'),n.b("\n"+e),n.s(n.f("data",t,i,1),t,i,0,114,1058,"{{ }}")&&(n.rs(t,i,function(t,i,n){n.b('    <a href="'),n.b(n.v(n.d("actor.url",t,i,0))),n.b('" class="avatar js-mini-profile" data-id="'),n.b(n.v(n.d("actor.id",t,i,0))),n.b('">'),n.b("\n"+e),n.b('      <div data-picture="" data-alt="'),n.b(n.v(n.d("actor.display_name",t,i,0))),n.b('">'),n.b("\n"+e),n.b('        <div alt="'),n.b(n.v(n.d("actor.display_name",t,i,0))),n.b('" data-src="'),n.b(n.v(n.d("actor.images.50",t,i,0))),n.b('" data-class="avatar-image" data-title="'),n.b(n.v(n.d("actor.display_name",t,i,0))),n.b('"></div>'),n.b("\n"+e),n.b('        <div alt="'),n.b(n.v(n.d("actor.display_name",t,i,0))),n.b('" data-src="'),n.b(n.v(n.d("actor.images.115",t,i,0))),n.b('" data-class="avatar-image avatar-image-2x" data-title="'),n.b(n.v(n.d("actor.display_name",t,i,0))),n.b('" data-media="(-webkit-min-device-pixel-ratio: 1.3),'),n.b("\n"+e),n.b("          (min--moz-device-pixel-ratio: 1.3),"),n.b("\n"+e),n.b("          (-o-min-device-pixel-ratio: 4/3),"),n.b("\n"+e),n.b("          (min-device-pixel-ratio: 1.3),"),n.b("\n"+e),n.b('          (min-resolution: 1.3dppx)"></div>'),n.b("\n"+e),n.b("      </div>"),n.b("\n"+e),n.b('      <noscript><img alt="'),n.b(n.v(n.d("actor.display_name",t,i,0))),n.b('" title="'),n.b(n.v(n.d("actor.display_name",t,i,0))),n.b('" src="'),n.b(n.v(n.d("actor.images.50",t,i,0))),n.b('" class="avatar-image" /></noscript>'),n.b("\n"+e),n.b("    </a>"),n.b("\n"+e),n.b('    <div class="detail beside-avatar">'),n.b("\n"+e),n.b(n.rp("<innard0",t,i,"      ")),n.b('      <div class="time">'),n.b(n.v(n.f("time_ago",t,i,0))),n.b("</div>"),n.b("\n"+e),n.b("    </div>"),n.b("\n"+e)}),t.pop()),n.b("  </div>"),n.b("\n"+e),n.b("</div>"),n.b("\n"),n.fl()},partials:{"<innard0":{name:"innard",partials:{},subs:{}}},subs:{}},"",t);return i.template=e,i}),define("be/View/Notification",["jquery","moment","nbd/View/Entity","lib/picturefill","lib/truncate","be/trait/notificationPartial","hgn!templates/notification"],function(t,i,e,n,o,a,s){"use strict";var r=e.extend({template:function(i){return t(s(i,this.generatePartials(i)))},templateData:function(){var t=this._super();return t.time_ago=function(){return i.unix(t.created_on).fromNow()},t},rendered:function(){this.$view.picturefill().find(".comment-text").contents().toArray().forEach(function(t){o(t,4)})},update:function(){if(this.$view){var t=this.templateData().time_ago();this.$view.removeClass("unread").find(".time").text(t)}}}).mixin(a);return r}),define("be/Controller/Notification",["nbd/Controller/Entity","be/View/Notification"],function(t,i){"use strict";var e=t.extend({update:function(){this._view.update()}},{VIEW_CLASS:i});return e}),define("require/hgn!templates/notificationGroup",["hogan"],function(t){function i(){return e.render.apply(e,arguments)}var e=new t.Template({code:function(t,i,e){var n=this;return n.b(e=e||""),n.b('<div class="notification-group">'),n.b("\n"+e),n.b('  <div class="js-context"></div>'),n.b("\n"+e),n.b('  <div class="js-more notification-group-more">+ <span class="count">0</span> More Updates</div>'),n.b("\n"+e),n.b("</div>"),n.b("\n"),n.fl()},partials:{},subs:{}},"",t);return i.template=e,i}),define("be/View/NotificationGroup",["jquery","nbd/View/Entity","nbd/util/async","nbd/util/pipe","hgn!templates/notificationGroup"],function(t,i,e,n,o){"use strict";var a=i.extend({template:n(o,t),draw:function(t){var i,n=this._model.get("entries");n&&n.length&&(this._iterator=this._iterator||0,n=n.slice(this._iterator,+t?this._iterator+=t:void 0),i=this.$view.find(".js-context"),n.forEach(function(t){t.render(i)}),this._iterator||e(function(){this._iterator=0}.bind(this)))},rendered:function(){this.draw(3);var i=this._model.get("entries").length-(this._iterator||0);i?this.$view.on("click",".js-more",function(){t(this).hide()}).one("click",".js-more",this.draw.bind(this)).find(".count").text(i):this.$view.find(".js-more").hide()}});return a}),define("be/Controller/NotificationGroup",["nbd/Controller/Entity","be/View/NotificationGroup"],function(t,i){"use strict";var e=t.extend({add:function(t){var i=this._model.get("entries")||[];i.push(t),this._model.set("entries",i)},update:function(){var t=this._model.get("entries")||[];t.forEach(function(t){t.update()})}},{VIEW_CLASS:i});return e}),define("be/spinner",["jquery","vendor/spin"],function(t,i){"use strict";var e={lines:30,length:0,width:2,radius:9,corners:0,speed:2,trail:100,hwaccel:!0,className:"spinner",zIndex:2e9,top:"19px",left:"20px",opacity:"0"};return{init:function(i){var e=t(".js-spin",i);return e.length||(e=this._generate()),e.toArray().map(this.create),e},show:function(){this._$default||this._generate(),this._$default.appendTo(document.body)},hide:function(){this._$default&&this._$default.detach()},_generate:function(){return this._$default=t("<div>",{"class":"js-spin be-spinner"}),this.create(this._$default[0]),this._$default},create:function(n,o){var a=new i(t.extend({},e,o));return n&&a.spin(n),a}}}),define("require/hgn!templates/bell/section",["hogan"],function(t){function i(){return e.render.apply(e,arguments)}var e=new t.Template({code:function(t,i,e){var n=this;return n.b(e=e||""),n.b('<div class="activity-container js-'),n.b(n.v(n.f("type",t,i,0))),n.b('-activity">'),n.b("\n"+e),n.b('  <h2 class="bell-title '),n.b(n.v(n.f("type",t,i,0))),n.b('-title hide-phone js-bell-title">'),n.b(n.v(n.f("title",t,i,0))),n.b("</h2>"),n.b("\n"+e),n.b('  <h2 class="bell-title bell-title-dummy hide-phone js-bell-title-dummy">'),n.b(n.v(n.f("title",t,i,0))),n.b("</h2>"),n.b("\n"+e),n.b('  <div class="js-spin loading-spinner cfix"></div>'),n.b("\n"+e),n.b("</div>"),n.b("\n"),n.fl()},partials:{},subs:{}},"",t);return i.template=e,i}),define("require/hgn!templates/notificationEmpty",["hogan"],function(t){function i(){return e.render.apply(e,arguments)}var e=new t.Template({code:function(t,i,e){var n=this;return n.b(e=e||""),n.b('<div class="notifications-empty">You will receive notifications when people appreciate, comment on or collect your work.</div>'),n.b("\n"),n.fl()},partials:{},subs:{}},"",t);return i.template=e,i}),define("be/View/Notifications",["jquery","nbd/View/Entity","nbd/util/pipe","be/spinner","hgn!templates/bell/section","hgn!templates/notificationEmpty"],function(t,i,e,n,o,a){"use strict";var s=i.extend({template:e(o,t),templateData:function(){return{title:"Your Notifications",type:"notification"}},rendered:function(){this.$loading=n.init(this.$view),this.$loading.hide(),this.listenTo(this._model,"entries",this.draw),this.draw(this._model.get("entries"))},draw:function(t){t&&(t.forEach(function(t){t.render(this.$view)}.bind(this)),this.empty(!t.length))},empty:function(i){var e=!i;this.$empty=this.$empty||t(a()),e?this.$empty.remove():this.$view.append(this.$empty)}});return s}),define("be/Controller/Notifications",["nbd/trait/pubsub","nbd/Controller/Entity","nbd/util/async","lib/xhr","be/Controller/Notification","be/Controller/NotificationGroup","be/View/Notifications"],function(t,i,e,n,o,a,s){"use strict";var r,c="/v2/notifications?action_set=bell-note-v1";return r=i.extend({refresh:function(){return this._model.get("entries")?void(this.block||this.get()):this.more()},get:function l(){var t=l.bind(this),i=this._model,n=this.read({onset_ts:i.get("onset")}).then(function(n){if(!n.notifications)throw n;return i.set("onset",n.latest_ts),n.has_more&&e(t),n.notifications}).then(this.constructor.makeEntries);return n.then(function(t){var e=i.get("entries")||[];i.set("entries",t.concat(e))}).then(this.trigger.bind(this,"sync")),n},more:function b(){if(!b.block){b.block=!0;var t=this._model,i=this.read({offset_ts:t.get("offset")}).then(function(i){if(!i.notifications)throw i;b.block=!i.has_more;var e=t.data();return e.onset=e.onset||i.latest_ts,e.offset=i.earliest_ts,i.notifications}).then(this.constructor.makeEntries);return i.then(function(i){var e=t.get("entries")||[];t.set("entries",e.concat(i))}).then(this.trigger.bind(this,"sync")),i}},read:function(t){try{this._view.$loading.show()}catch(i){}var e=function(){this._view.$loading.hide()}.bind(this),o=n({url:c,type:"get",data:t});return o.then(e,e),o},update:function(){var t=this._model.get("entries");t&&t.length&&t.forEach(function(t){t.update()})},clear:function(){n({url:c,type:"delete"})}},{VIEW_CLASS:s,makeEntries:function(t){var i,e,n,s=[],r=0,c=2;for(e=0;e<t.length;++e)if(t[e+1]&&t[e+1].action_key===t[e].action_key)r++;else{if(r>=c){for(i=new a,n=e-r;e>=n;++n)i.add(new o(t[n]));s.push(i)}else for(n=e-r;e>=n;++n)s.push(new o(t[n]));r=0}return s}}).mixin(t)}),define("be/trait/eventMappable",[],function(){"use strict";function t(t,i,e){var n=[],o=t[i],a=function(t){var i=[];return"string"==typeof t?i.push({method:e[t].bind(e)}):"function"==typeof t?i.push({method:t}):Object.keys(t).forEach(function(e){var n=a(t[e]);i.push({selector:e,method:n[0].method})}),i};return Array.isArray(o)?o.forEach(function(t){n.push.apply(n,a(t))}):n.push.apply(n,a(o)),n}var i={_mapEvents:function(){var i=this;this._undelegateEvents(),Object.keys(this.events).forEach(function(e){var n=t(i.events,e,i);e+=".delegated",n.forEach(function(t){t.selector?i.$view.on(e,t.selector,t.method):i.$view.on(e,t.method)})})},_undelegateEvents:function(){this.$view.off(".delegated")}};return i}),define("require/hgn!templates/notifications/proposition",["hogan"],function(t){function i(){return e.render.apply(e,arguments)}var e=new t.Template({code:function(t,i,e){var n=this;return n.b(e=e||""),n.b('<div class="proposition-group cfix">'),n.b("\n"+e),n.b('  <div class="js-invitation">'),n.b("\n"),n.b("\n"+e),n.b('    <a href="'),n.b(n.v(n.d("actor.url",t,i,0))),n.b('" class="avatar js-mini-profile" data-id="'),n.b(n.v(n.d("actor.id",t,i,0))),n.b('">'),n.b("\n"+e),n.b('      <div data-picture="" data-alt="'),n.b(n.v(n.d("actor.display_name",t,i,0))),n.b('">'),n.b("\n"+e),n.b('        <div alt="'),n.b(n.v(n.d("actor.display_name",t,i,0))),n.b('" data-src="'),n.b(n.v(n.d("actor.images.50",t,i,0))),n.b('" data-class="avatar-image" data-title="'),n.b(n.v(n.d("actor.display_name",t,i,0))),n.b('"></div>'),n.b("\n"+e),n.b('        <div alt="'),n.b(n.v(n.d("actor.display_name",t,i,0))),n.b('" data-src="'),n.b(n.v(n.d("actor.images.115",t,i,0))),n.b('" data-class="avatar-image avatar-image-2x" data-title="'),n.b(n.v(n.d("actor.display_name",t,i,0))),n.b('" data-media="(-webkit-min-device-pixel-ratio: 1.3),'),n.b("\n"+e),n.b("          (min--moz-device-pixel-ratio: 1.3),"),n.b("\n"+e),n.b("          (-o-min-device-pixel-ratio: 4/3),"),n.b("\n"+e),n.b("          (min-device-pixel-ratio: 1.3),"),n.b("\n"+e),n.b('          (min-resolution: 1.3dppx)"></div>'),n.b("\n"+e),n.b("      </div>"),n.b("\n"+e),n.b('      <noscript><img alt="'),n.b(n.v(n.d("actor.display_name",t,i,0))),n.b('" title="'),n.b(n.v(n.d("actor.display_name",t,i,0))),n.b('" src="'),n.b(n.v(n.d("actor.images.50",t,i,0))),n.b('" class="avatar-image" /></noscript>'),n.b("\n"+e),n.b("    </a>"),n.b("\n"),n.b("\n"+e),n.b('    <div class="detail beside-avatar">'),n.b("\n"+e),n.b('      <div class="msg extra-padding">'),n.b("\n"+e),n.b('        <a href="'),n.b(n.v(n.d("actor.url",t,i,0))),n.b('" class="js-mini-profile" data-id="'),n.b(n.v(n.d("actor.id",t,i,0))),n.b('">'),n.b(n.v(n.d("actor.display_name",t,i,0))),n.b("</a> invited you to "),n.b(n.v(n.f("action",t,i,0))),n.b("\n"+e),n.b("      </div>"),n.b("\n"),n.b("\n"+e),n.b('      <div class="graphic">'),n.b("\n"+e),n.b('        <div class="activity-block proposition-'),n.b(n.v(n.f("proposition",t,i,0))),n.b(' cfix">'),n.b("\n"+e),n.b(n.rp("<innards0",t,i,"          ")),n.b("\n"+e),n.b('          <button class="accept right js-accept form-button form-button-small form-button-default">Accept</button>'),n.b("\n"+e),n.b("        </div>"),n.b("\n"+e),n.b("      </div>"),n.b("\n"),n.b("\n"+e),n.b('      <div class="time">'),n.b("\n"+e),n.b('        <span class="proposition-time js-time">'),n.b(n.v(n.f("time_ago",t,i,0))),n.b("</span>"),n.b("\n"+e),n.b('        <span class="js-reject proposition-reject">Decline invitation</span>'),n.b("\n"+e),n.b("      </div>"),n.b("\n"),n.b("\n"+e),n.b("    </div>"),n.b("\n"),n.b("\n"+e),n.b("  </div>"),n.b("\n"+e),n.b("</div>"),n.b("\n"),n.fl()},partials:{"<innards0":{name:"innards",partials:{},subs:{}}},subs:{}},"",t);return i.template=e,i}),define("require/hgn!templates/notifications/propositions/collection",["hogan"],function(t){function i(){return e.render.apply(e,arguments)}var e=new t.Template({code:function(t,i,e){var n=this;return n.b(e=e||""),n.s(n.f("collection",t,i,1),t,i,0,15,773,"{{ }}")&&(n.rs(t,i,function(t,i,n){n.b('  <a href="'),n.b(n.v(n.f("url",t,i,0))),n.b('">'),n.b("\n"+e),n.b('    <div data-picture="" data-alt="'),n.b(n.v(n.f("title",t,i,0))),n.b('">'),n.b("\n"+e),n.b('      <div alt="'),n.b(n.v(n.f("title",t,i,0))),n.b('" data-src="'),n.b(n.v(n.d("latest_projects.0.covers.115",t,i,0))),n.b('" data-class="comment-image" data-title="'),n.b(n.v(n.f("title",t,i,0))),n.b('"></div>'),n.b("\n"+e),n.b('      <div alt="'),n.b(n.v(n.f("title",t,i,0))),n.b('" data-src="'),n.b(n.v(n.d("latest_projects.0.covers.202",t,i,0))),n.b('" data-class="comment-image comment-image-2x" data-title="'),n.b(n.v(n.f("title",t,i,0))),n.b('" data-media="(-webkit-min-device-pixel-ratio: 1.3),'),n.b("\n"+e),n.b("          (min--moz-device-pixel-ratio: 1.3),"),n.b("\n"+e),n.b("          (-o-min-device-pixel-ratio: 4/3),"),n.b("\n"+e),n.b("          (min-device-pixel-ratio: 1.3),"),n.b("\n"+e),n.b('          (min-resolution: 1.3dppx)"></div>'),n.b("\n"+e),n.b("    </div>"),n.b("\n"+e),n.b('    <noscript><img alt="'),n.b(n.v(n.f("title",t,i,0))),n.b('" title="'),n.b(n.v(n.f("title",t,i,0))),n.b('" src="'),n.b(n.v(n.d("latest_projects.0.covers.115",t,i,0))),n.b('" class="comment-image" /></noscript>'),n.b("\n"+e),n.b("  </a>"),n.b("\n"+e),n.b('  <div class="proposition-subject">'),n.b(n.v(n.f("title",t,i,0))),n.b("</div>"),n.b("\n"+e)}),t.pop()),n.fl()},partials:{},subs:{}},"",t);return i.template=e,i}),define("require/hgn!templates/notifications/propositions/project",["hogan"],function(t){function i(){return e.render.apply(e,arguments)}var e=new t.Template({code:function(t,i,e){var n=this;return n.b(e=e||""),n.s(n.f("project",t,i,1),t,i,0,12,678,"{{ }}")&&(n.rs(t,i,function(t,i,n){n.b('  <div data-picture="" data-alt="'),n.b(n.v(n.f("name",t,i,0))),n.b('">'),n.b("\n"+e),n.b('    <div alt="'),n.b(n.v(n.f("name",t,i,0))),n.b('" data-src="'),n.b(n.v(n.d("covers.115",t,i,0))),n.b('" data-class="proposition-image" data-title="'),n.b(n.v(n.f("name",t,i,0))),n.b('"></div>'),n.b("\n"+e),n.b('    <div alt="'),n.b(n.v(n.f("name",t,i,0))),n.b('" data-src="'),n.b(n.v(n.d("covers.202",t,i,0))),n.b('" data-class="proposition-image proposition-image-2x" data-title="'),n.b(n.v(n.f("name",t,i,0))),n.b('" data-media="(-webkit-min-device-pixel-ratio: 1.3),'),n.b("\n"+e),n.b("        (min--moz-device-pixel-ratio: 1.3),"),n.b("\n"+e),n.b("        (-o-min-device-pixel-ratio: 4/3),"),n.b("\n"+e),n.b("        (min-device-pixel-ratio: 1.3),"),n.b("\n"+e),n.b('        (min-resolution: 1.3dppx)"></div>'),n.b("\n"+e),n.b("  </div>"),n.b("\n"+e),n.b('  <noscript><img alt="'),n.b(n.v(n.f("name",t,i,0))),n.b('" title="'),n.b(n.v(n.f("name",t,i,0))),n.b('" src="'),n.b(n.v(n.d("covers.115",t,i,0))),n.b('" class="proposition-image" /></noscript>'),n.b("\n"+e),n.b('  <div class="proposition-subject">'),n.b(n.v(n.f("name",t,i,0))),n.b("</div>"),n.b("\n"+e)}),t.pop()),n.fl()},partials:{},subs:{}},"",t);return i.template=e,i}),define("require/hgn!templates/notifications/propositions/team",["hogan"],function(t){function i(){return e.render.apply(e,arguments)}var e=new t.Template({code:function(t,i,e){var n=this;return n.b(e=e||""),n.b('<div data-picture="" data-alt="'),n.b(n.v(n.f("name",t,i,0))),n.b('">'),n.b("\n"+e),n.b('  <div alt="'),n.b(n.v(n.f("name",t,i,0))),n.b('" data-src="'),n.b(n.v(n.d("covers.115",t,i,0))),n.b('" data-class="comment-image" data-title="'),n.b(n.v(n.f("name",t,i,0))),n.b('"></div>'),n.b("\n"+e),n.b('  <div alt="'),n.b(n.v(n.f("name",t,i,0))),n.b('" data-src="'),n.b(n.v(n.d("covers.202",t,i,0))),n.b('" data-class="comment-image comment-image-2x" data-title="'),n.b(n.v(n.f("name",t,i,0))),n.b('" data-media="(-webkit-min-device-pixel-ratio: 1.3),'),n.b("\n"+e),n.b("      (min--moz-device-pixel-ratio: 1.3),"),n.b("\n"+e),n.b("      (-o-min-device-pixel-ratio: 4/3),"),n.b("\n"+e),n.b("      (min-device-pixel-ratio: 1.3),"),n.b("\n"+e),n.b('      (min-resolution: 1.3dppx)"></div>'),n.b("\n"+e),n.b("</div>"),n.b("\n"+e),n.b('<noscript><img alt="'),n.b(n.v(n.f("name",t,i,0))),n.b('" title="'),n.b(n.v(n.f("name",t,i,0))),n.b('" src="'),n.b(n.v(n.d("covers.115",t,i,0))),n.b('" class="comment-image" /></noscript>'),n.b("\n"+e),n.b('<div class="proposition-subject">'),n.b(n.v(n.f("name",t,i,0))),n.b("</div>"),n.fl()
},partials:{},subs:{}},"",t);return i.template=e,i}),define("be/View/Proposition",["jquery","moment","nbd/View/Entity","nbd/trait/promise","nbd/util/extend","lib/picturefill","be/trait/eventMappable","hgn!templates/notifications/proposition","hgn!templates/notifications/propositions/collection","hgn!templates/notifications/propositions/project","hgn!templates/notifications/propositions/team"],function(t,i,e,n,o,a,s,r,c,l){"use strict";var b,d="Invitation declined",u=250,p={project_owner:l.template,collection_owner:c.template,feedback_circle:l.template},f={project_owner:"co-own a Project",collection_owner:"co-own a Collection",feedback_circle:"join their Feedback Circle"};return b=e.extend({events:{click:{".js-accept":"_acceptInvitation",".js-reject":"_rejectInvitation"}},template:function(i){return t(r(i,{innards:this._getInnerContentPartial(i)}))},templateData:function(){var t=this._super();return o({action:f[t.type],actor:t.other_user,proposition:"project",time_ago:function(){return i.unix(t.created_on).fromNow()}},t)},rendered:function(){this.$rejectBtn=this.$view.find(".js-reject"),this.$time=this.$view.find(".js-time"),this.$view.picturefill(),this._mapEvents()},update:function(){if(this.$view){var t=this.templateData().time_ago;this.$time.text(t)}},informAndFade:function(){var t=new n;return this.$rejectBtn.text(d),this.$view.fadeOut(u,t.resolve.bind(t)),t},_getInnerContentPartial:function(t){return p[t.type]},_acceptInvitation:function(){this._controller.accept()},_rejectInvitation:function(){this._controller.reject()}}).mixin(s)}),define("be/Controller/Proposition",["nbd/Controller/Entity","nbd/trait/pubsub","lib/xhr","be/View/Proposition"],function(t,i,e,n){"use strict";var o,a="/v2/notifications/invitations/";return o=t.extend({update:function(){this._view.update()},accept:function(){e({url:a+this._model.get("id"),type:"put"}).then(this._view.informAndFade.bind(this._view)).then(this._remove.bind(this))},reject:function(){e({url:a+this._model.get("id"),type:"delete"}).then(this._view.informAndFade.bind(this._view)).then(this._remove.bind(this))},_remove:function(){this.trigger("resolve",this._model.get("id")),this.destroy()}},{VIEW_CLASS:n}).mixin(i)}),define("be/View/Propositions",["jquery","nbd/View/Entity","nbd/util/pipe","be/spinner","hgn!templates/bell/section"],function(t,i,e,n,o){"use strict";var a=i.extend({template:e(o,t),templateData:function(){return{title:"Your Requests",type:"propositions"}},rendered:function(){this.$loading=n.init(this.$view),this.$loading.hide(),this.listenTo(this._model,"entries",this._draw),this._draw(this._model.get("entries"))},update:function(){},_draw:function(t){return t&&Object.keys(t).length?(this.$view.removeClass("hide"),void Object.keys(t).forEach(function(i){var e=t[i];e&&e.render(this.$view)}.bind(this))):void this.$view.addClass("hide")}});return a}),define("be/Controller/Propositions",["nbd/trait/pubsub","nbd/Controller/Entity","lib/xhr","be/Controller/Proposition","be/View/Propositions"],function(t,i,e,n,o){"use strict";var a,s="/v2/notifications/invitations";return a=i.extend({more:function r(){if(!r.block){r.block=!0;var t=this,i=this._model,e=this.read();return e.then(function(t){if(!t.invitations)throw t;return t.invitations}).then(function(i){var e=i.map(function(t){return new n(t)});return e.forEach(function(i){t.listenTo(i,"resolve",t._updateEntries)}),e}).then(function(t){var e=i.get("entries")||{},n=t.reduce(function(t,i){var e=i._model.get("id");return t[e]=i,t},e);return i.set("entries",n),Object.keys(n).length}).then(this.trigger.bind(this,"sync")),e}},count:function(){var t=this._model.get("entries");return t?Object.keys(t).length:0},read:function(){try{this._view.$loading.show()}catch(t){}var i=function(){this._view.$loading.hide()}.bind(this),n=e({url:s});return n.then(i,i),n},update:function(){var t=this._model.get("entries");t&&Object.keys(t).length&&Object.keys(t).forEach(function(i){var e=t[i];e&&e.update()}.bind(this))},_updateEntries:function(t){var i=this._model.get("entries")||{};i[t]&&delete i[t],this._model.set("entries",i),this.trigger("removed")}},{VIEW_CLASS:o}).mixin(t)}),define("require/hgn!templates/dialog",["hogan"],function(t){function i(){return e.render.apply(e,arguments)}var e=new t.Template({code:function(t,i,e){var n=this;return n.b(e=e||""),n.b('<div class="popup '),n.b(n.v(n.f("dialogType",t,i,0))),n.s(n.f("classes",t,i,1),t,i,0,44,50,"{{ }}")&&(n.rs(t,i,function(t,i,e){e.b(" "),e.b(e.v(e.d(".",t,i,0)))}),t.pop()),n.s(n.f("buttons",t,i,1),t,i,1,0,0,"")||n.b(" no-buttons"),n.s(n.f("title",t,i,1),t,i,1,0,0,"")||n.b(" no-title"),n.s(n.f("fullBleed",t,i,1),t,i,0,140,151,"{{ }}")&&(n.rs(t,i,function(t,i,e){e.b(" full-bleed")}),t.pop()),n.b('">'),n.b("\n"+e),n.b('  <div class="popup-inner-wrap">'),n.b("\n"),n.b("\n"+e),n.s(n.f("toolbar",t,i,1),t,i,0,218,647,"{{ }}")&&(n.rs(t,i,function(t,i,n){n.b('    <div class="'),n.s(n.f("layover",t,i,1),t,i,0,247,254,"{{ }}")&&(n.rs(t,i,function(t,i,e){e.b("toolbar")}),t.pop()),n.s(n.f("layover",t,i,1),t,i,1,0,0,"")||n.b("popup-header"),n.b('">'),n.b("\n"+e),n.b('      <div class="header">'),n.b(n.t(n.f("title",t,i,0))),n.b("</div>"),n.b("\n"+e),n.s(n.f("hideClose",t,i,1),t,i,1,0,0,"")||(n.b('        <a class="header-action close right js-close'),n.s(n.f("layover",t,i,1),t,i,1,0,0,"")||n.b(" popup-close"),n.b('">'),n.b("\n"+e),n.b('          <span class="nav-icon-close nav-icon"></span>'),n.b("\n"+e),n.b("        </a>"),n.b("\n"+e)),n.s(n.f("layover",t,i,1),t,i,0,569,619,"{{ }}")&&(n.rs(t,i,function(t,i,e){e.s(e.f("button",t,i,1),t,i,0,589,601,"{{ }}")&&(e.rs(t,i,function(t,i,e){e.b(e.rp("<button0",t,i,""))}),t.pop())}),t.pop()),n.b("    </div>"),n.b("\n"+e)}),t.pop()),n.b("\n"+e),n.b('    <div class="popup-content'),n.s(n.f("toolbar",t,i,1),t,i,0,702,714,"{{ }}")&&(n.rs(t,i,function(t,i,e){e.b(" has-toolbar")}),t.pop()),n.b('">'),n.b("\n"+e),n.b(n.rp("<content1",t,i,"      ")),n.s(n.f("layover",t,i,1),t,i,1,0,0,"")||(n.b("    </div>"),n.b("\n"+e)),n.b("\n"+e),n.b('      <div class="popup-buttons'),n.s(n.f("buttons",t,i,1),t,i,1,0,0,"")||n.b(" hide"),n.b('">'),n.b("\n"+e),n.s(n.f("buttons",t,i,1),t,i,0,878,890,"{{ }}")&&(n.rs(t,i,function(t,i,e){e.b(e.rp("<button2",t,i,""))}),t.pop()),n.b("      </div>"),n.b("\n"),n.b("\n"+e),n.s(n.f("layover",t,i,1),t,i,0,933,949,"{{ }}")&&(n.rs(t,i,function(t,i,n){n.b("    </div>"),n.b("\n"+e)}),t.pop()),n.b("\n"+e),n.b("  </div> <!-- /.popup-inner -->"),n.b("\n"),n.b("\n"+e),n.b("</div>"),n.b("\n"),n.b("\n"+e),n.s(n.f("blocking",t,i,1),t,i,0,1017,1051,"{{ }}")&&(n.rs(t,i,function(t,i,n){n.b('<div class="blocking-div"></div>'),n.b("\n"+e)}),t.pop()),n.fl()},partials:{"<button0":{name:"button",partials:{},subs:{}},"<content1":{name:"content",partials:{},subs:{}},"<button2":{name:"button",partials:{},subs:{}}},subs:{}},"",t);return i.template=e,i}),define("require/hgn!templates/button",["hogan"],function(t){function i(){return e.render.apply(e,arguments)}var e=new t.Template({code:function(t,i,e){var n=this;return n.b(e=e||""),n.b('  <div class="form-item form-item-a'),n.s(n.f("containerClasses",t,i,1),t,i,0,56,62,"{{ }}")&&(n.rs(t,i,function(t,i,e){e.b(" "),e.b(e.v(e.d(".",t,i,0)))}),t.pop()),n.b('">'),n.b("\n"+e),n.b('    <a class="form-button'),n.s(n.f("classes",t,i,1),t,i,0,123,129,"{{ }}")&&(n.rs(t,i,function(t,i,e){e.b(" "),e.b(e.v(e.d(".",t,i,0)))}),t.pop()),n.s(n.f("classes",t,i,1),t,i,1,0,0,"")||n.b(" form-button-default"),n.b('"'),n.b("\n"+e),n.b("      "),n.s(n.f("href",t,i,1),t,i,0,202,218,"{{ }}")&&(n.rs(t,i,function(t,i,e){e.b(' href="'),e.b(e.v(e.f("href",t,i,0))),e.b('"')}),t.pop()),n.b(' unselectable="on"'),n.b("\n"+e),n.b("      tabindex="),n.s(n.f("tabindex",t,i,1),t,i,0,274,288,"{{ }}")&&(n.rs(t,i,function(t,i,e){e.b('"'),e.b(e.v(e.f("tabindex",t,i,0))),e.b('"')}),t.pop()),n.b("\n"+e),n.b("      "),n.s(n.f("tabindex",t,i,1),t,i,1,0,0,"")||n.b('"0"'),n.b(">"),n.b(n.v(n.f("label",t,i,0))),n.b("</a>"),n.b("\n"+e),n.b("  </div>"),n.b("\n"),n.fl()},partials:{},subs:{}},"",t);return i.template=e,i}),define("be/View/Dialog",["jquery","nbd/View/Entity","nbd/util/extend","hgn!templates/dialog","hgn!templates/button"],function(t,i,e,n,o){"use strict";var a=i.extend({mustache:{},template:function(i){return t(n(i,e({content:this.mustache.template,button:o.template},this.partials)))},rendered:function(){this.$view.on("click",".js-close, .close, .form-button-close, .form-button-cancel",this.hide.bind(this)).find(".form-button-disabled").on("click",!1)},position:function(){},show:function(){return this.trigger("show",this.$view)},hide:function(){return this.trigger("hide",this.$view)},toggle:function(){var t=this.$view.is(":visible");return this[t?"hide":"show"]()}});return a}),define("be/View/Dialog/Layover",["jquery","be/View/Dialog"],function(t,i){"use strict";var e=i.extend({destroy:function(){this.hide(),this._super()},template:function(i){return this._super(t.extend({dialogType:"layover",layover:!0,toolbar:!0},i))},rendered:function(){this._super(),this.show()},show:function(){return this.$view?(this.scrollTop=this.scrollTop||t(window).scrollTop(),t("#site-content").hide(),t("html").addClass("overflow-hidden"),this.$view.show(),this._super()):void 0},hide:function(){return this.$view?(t("#site-content").show(),t("html").removeClass("overflow-hidden"),window.scrollTo(0,this.scrollTop),delete this.scrollTop,this.$view.hide(),this._super()):void 0}});return e}),define("lib/infinitescroll",["jquery","log"],function(t,i){"use strict";function e(t){t()}function n(t){var i,e;return t.is(s)?(i=window.innerHeight||s.height(),e=r.height()-i-s.scrollTop()):(i=t.prop("clientHeight"),e=t.prop("scrollHeight")-i-t.scrollTop()),e/i}function o(i){var o="window"===i?s:t(i);return function(){var t,a=n(o);for(t in l[i])a<=Number(t)&&l[i][t].wrapped.forEach(e)}}function a(e,n,a){function r(){if(!r.blocking){r.blocking=!0;var t=n.apply(null,arguments);t&&"function"==typeof t.then?t.then(function(){r.blocking=!1,c[a]()},function(t){t instanceof Error&&i.warn(t)}):r.blocking=!1}}"function"==typeof e&&(a=n,n=e,e=1),a=a||"window",e=Number(e).toString();var b,d="window"===a?s:t(a);l[a]||(l[a]={},c[a]=o(a),d.on("scroll",c[a])),b=l[a][e],b||(b=l[a][e]={wrapped:[],original:[]}),b.original.push(n),b.wrapped.push(r),c[a]()}var s=t(window),r=t(document),c={},l={};return a.remove=function(t,i){i=i||"window";var e,n,o;for(e in l[i])n=l[i][e],o=n.original.indexOf(t),~o&&(n.original.splice(o,1),n.wrapped.splice(o,1))},a.check=function(t){t=t||"window",c[t]()},a}),define("require/hgn!templates/html",["hogan"],function(t){function i(){return e.render.apply(e,arguments)}var e=new t.Template({code:function(t,i,e){var n=this;return n.b(e=e||""),n.b(n.t(n.f("html",t,i,0))),n.b("\n"),n.fl()},partials:{},subs:{}},"",t);return i.template=e,i}),define("require/hgn!templates/bell/dialog",["hogan"],function(t){function i(){return e.render.apply(e,arguments)}var e=new t.Template({code:function(t,i,e){var n=this;return n.b(e=e||""),n.b('<div class="activity-container-wrap">'),n.b("\n"+e),n.b('  <div class="bell-section propositions-section js-propositions"></div>'),n.b("\n"+e),n.b('  <div class="bell-section notifications-section js-notifications"></div>'),n.b("\n"+e),n.b("</div>"),n.b("\n"),n.fl()},partials:{},subs:{}},"",t);return i.template=e,i}),define("be/trait/bell",["jquery","nbd/util/pipe","lib/infinitescroll","be/spinner","hgn!templates/html","hgn!templates/bell/dialog"],function(t,i,e,n,o,a){"use strict";var s=0;return{mustache:o,selector:".popup-content .activity-container-wrap",templateData:function(){return{title:"Notifications",classes:["notifications","timeline-container"],html:a}},rendered:function(){this._super(),this._bindScroll(),this._bindInfiniteScroll()},renderNotifications:function(t){this.$notifications||(this.$notifications=this.$view.find(".js-notifications"),t.render(this.$notifications))},renderPropositions:function(t){this.$propositions||(this.$propositions=this.$view.find(".js-propositions"),t.render(this.$propositions))},_bindInfiniteScroll:function(){e(.5,function(){this._controller.more()}.bind(this),this.selector)},_bindScroll:function(){this.$view.find(this.selector).on("scroll",function(){this.$headers=this.$headers||this.$view.find(".js-bell-title").toArray();var i=this.$headers.map(function(i){var e=t(i),n=e.position();return e.is(".sticky")&&(n=e.siblings(".js-bell-title-dummy").position()),{$el:e,offsetTop:n.top}}.bind(this)).filter(function(t){return t.$el.is(":visible")}).reduce(function(t,i){var e;return t?e=i.offsetTop>s?t:i.offsetTop>t.offsetTop?i:t:i});i.$el.is(".js-bell-title-dummy")||(this.$currentHeader&&this.$currentHeader.length&&this.$currentHeader.removeClass("sticky"),i.$el.addClass("sticky"),this.$currentHeader=i.$el)}.bind(this))}}}),define("be/View/Dialog/Layover/Bell",["be/View/Dialog/Layover","be/trait/bell"],function(t,i){"use strict";var e=t.extend(i);return e}),define("be/View/Dialog/Menu",["jquery","be/View/Dialog","nbd/util/async","jquery/ui/position"],function(t,i,e){"use strict";var n=i.extend({init:function(){this._super.apply(this,arguments),this.dismiss=function(t){t.originalEvent.data!==this&&(this.hide(),t.preventDefault())}.bind(this)},destroy:function(){this._unbind(),this._super.apply(this,arguments)},template:function(i){return this._super(t.extend({dialogType:"menu",blocking:!1,hide_toolbar:!0},i))},rendered:function(){this._super();var t=this;this.$view.on("click touchend",function(i){i.originalEvent.data=t})},_bind:function(){t("html").on("click touchend",this.dismiss)},_unbind:function(){t("html").off("click touchend",this.dismiss)},position:function(i,e){if(this.$view){i&&(this._lastContext=i);var n={my:"left top",at:"left bottom+10",of:this._lastContext,collision:"flipfit"};this.$view.position(t.extend(n,e))}},show:function(){return this.$view?(e(this._bind.bind(this)),this.$view.addClass("shown"),this._super()):void 0},hide:function(){return this.$view?(this._unbind(),this.$view.removeClass("shown"),this._super()):void 0},toggle:function(){return this[this.$view.hasClass("shown")?"hide":"show"]()}});return n}),define("be/View/Dialog/Menu/Bell",["nbd/util/extend","be/View/Dialog/Menu","be/trait/bell"],function(t,i,e){"use strict";var n,o="107",a="10",s="5";return n=i.extend(t({position:function(t){return this._super(t,{my:"left-"+o+" top-"+a,at:"center bottom+"+s,collision:"none"})}},e))}),define("be/Controller/Dialog/Bell",["nbd/trait/pubsub","be/Controller/Dialog/Roulette","be/Controller/Notifications","be/Controller/Propositions","be/View/Dialog/Layover/Bell","be/View/Dialog/Menu/Bell"],function(t,i,e,n,o,a){"use strict";var s=i.extend({init:function(){this._hasPropositions=$(document.body).hasClass("flag-inbox-v2"),this._notifications=new e,this._propositions=this._hasPropositions?new n:null,this._count=0,this._super.apply(this,arguments)},_initView:function(){if(this._super.apply(this,arguments),this._view){var t=this._renderSections.bind(this),i=this._updateSections.bind(this);this._hasPropositions?this.listenTo(this._propositions,"sync",function(t){this._count+=t,this._syncCount()}).listenTo(this._propositions,"removed",function(){this._count=Math.max(this._count-1,0),this._syncCount()}):(t=function(){this._view.renderNotifications(this._notifications)}.bind(this),i=function(){this._notifications.update()}.bind(this)),this.listenTo(this._notifications,"sync",this._syncCount.bind(this)).listenTo(this._view,"show",t).listenTo(this._view,"show",i).listenTo(this._view,"show",function(){this._notifications.clear()})}},_syncCount:function(){this.trigger("sync",this._count)},_renderSections:function(){this._view.renderNotifications(this._notifications),this._view.renderPropositions(this._propositions)},_updateSections:function(){this._notifications.update(),this._propositions.update()},more:function(){this._notifications.more(),this._propositions&&this._propositions.more()}},{VIEW_CLASS:{phone:o,tablet:a,desktop:a}}).mixin(t);return s}),define("be/bell",["jquery","has","lib/xhr","be/Controller/Dialog/Bell"],function(t,i,e,n){"use strict";var o,a="/v2/notifications/count",s="bell-count-v1",r="bell-note-v1";return o={init:function(e){var o=t(".js-bell-menu",e),a=t(document.body).hasClass("flag-inbox-v2");o.length&&(this.$bell=o,this._actionSet=a?s:r,this._dialog=new n,this._dialog.setContext(o),this._dialog.on("sync",function(t){this.update(t||0)},this),i("localstorage")&&this.update(window.sessionStorage.getItem("notifications")||0),this._sync())},destroy:function(){this._dialog&&this._dialog.destroy(),clearInterval(this._interval)},update:function(t){var i=0===+t;this.$bell.toggleClass("unread",!i).find(".notifications-count").toggleClass("hide",i).text(t),this._dialog.block=i},_sync:function(){return e({url:a,type:"get",data:{action_set:this._actionSet}}).then(function(t){return i("localstorage")&&window.sessionStorage.setItem("notifications",t.count),t.count}).then(o.update.bind(o))}}});